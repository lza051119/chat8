# Chat8 çœŸå®é‚®ä»¶å‘é€åŠŸèƒ½å®ç°è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

æœ¬é¡¹ç›®å·²æˆåŠŸå®ç°äº†çœŸå®é‚®ä»¶å‘é€åŠŸèƒ½ï¼Œæ”¯æŒå‘ `future_234@qq.com` ç­‰çœŸå®é‚®ç®±å‘é€éªŒè¯ç ã€‚ç³»ç»Ÿæ”¯æŒä¸¤ç§æ¨¡å¼ï¼š

- **å¼€å‘æ¨¡å¼**: æ¨¡æ‹Ÿé‚®ä»¶å‘é€ï¼Œåœ¨æ§åˆ¶å°æ˜¾ç¤ºéªŒè¯ç 
- **ç”Ÿäº§æ¨¡å¼**: çœŸå®é‚®ä»¶å‘é€ï¼Œé€šè¿‡SMTPæœåŠ¡å‘é€åˆ°ç”¨æˆ·é‚®ç®±

## æ ¸å¿ƒæ–‡ä»¶ä¿®æ”¹

### 1. é‚®ä»¶é…ç½® (`backend/app/core/email_config.py`)

```python
# å¼€å‘æ¨¡å¼æ ‡å¿— - è®¾ç½®ä¸ºfalseå¯ç”¨çœŸå®é‚®ä»¶å‘é€
DEVELOPMENT_MODE = os.getenv("DEVELOPMENT_MODE", "false").lower() == "true"

# é‚®ä»¶é…ç½® - æ”¯æŒQQé‚®ç®±
conf = ConnectionConfig(
    MAIL_USERNAME=os.getenv("MAIL_USERNAME", "future_234@qq.com"),
    MAIL_PASSWORD=os.getenv("MAIL_PASSWORD", "your_qq_auth_code"),  # QQé‚®ç®±æˆæƒç 
    MAIL_FROM=os.getenv("MAIL_FROM", "future_234@qq.com"),
    MAIL_PORT=587,
    MAIL_SERVER=os.getenv("MAIL_SERVER", "smtp.qq.com"),  # QQé‚®ç®±SMTPæœåŠ¡å™¨
    MAIL_STARTTLS=True,
    MAIL_SSL_TLS=False,
    USE_CREDENTIALS=True,
    VALIDATE_CERTS=True,
    TEMPLATE_FOLDER=Path(__file__).parent.parent / 'templates'
)
```

### 2. ç¯å¢ƒå˜é‡é…ç½® (`backend/.env`)

```env
# é‚®ä»¶é…ç½®
MAIL_USERNAME=future_234@qq.com
MAIL_PASSWORD=your_qq_auth_code_here
MAIL_FROM=future_234@qq.com
MAIL_SERVER=smtp.qq.com

# å¼€å‘æ¨¡å¼è®¾ç½® - è®¾ç½®ä¸ºfalseå¯ç”¨çœŸå®é‚®ä»¶å‘é€
DEVELOPMENT_MODE=false

# æ•°æ®åº“é…ç½®
DATABASE_URL=sqlite:///./chat_app.db

# JWTé…ç½®
SECRET_KEY=your-secret-key-here
ALGORITHM=HS256
ACCESS_TOKEN_EXPIRE_MINUTES=30
```

### 3. ä¸»åº”ç”¨æ–‡ä»¶ (`backend/app/main.py`)

æ·»åŠ äº†ç¯å¢ƒå˜é‡åŠ è½½ï¼š

```python
from dotenv import load_dotenv
import os

# åŠ è½½ç¯å¢ƒå˜é‡
load_dotenv()
```

### 4. ä¾èµ–ç®¡ç† (`backend/requirements.txt`)

æ·»åŠ äº†å¿…è¦çš„ä¾èµ–ï¼š

```txt
fastapi-mail==1.4.1
aiosmtplib==2.0.2
python-dotenv==1.0.0
```

## QQé‚®ç®±é…ç½®æ­¥éª¤

### 1. è·å–QQé‚®ç®±æˆæƒç 

1. ç™»å½• [QQé‚®ç®±ç½‘é¡µç‰ˆ](https://mail.qq.com)
2. ç‚¹å‡»å·¦ä¸Šè§’"è®¾ç½®" â†’ "è´¦æˆ·"
3. æ‰¾åˆ°"POP3/IMAP/SMTP/Exchange/CardDAV/CalDAVæœåŠ¡"
4. å¼€å¯"SMTPæœåŠ¡"
5. ç‚¹å‡»"ç”Ÿæˆæˆæƒç "
6. æŒ‰æç¤ºå‘é€çŸ­ä¿¡è·å–æˆæƒç 
7. å°†æˆæƒç ä¿å­˜å¤‡ç”¨

### 2. é…ç½®ç¯å¢ƒå˜é‡

åœ¨ `backend/.env` æ–‡ä»¶ä¸­è®¾ç½®ï¼š

```env
MAIL_USERNAME=future_234@qq.com
MAIL_PASSWORD=ä½ çš„QQé‚®ç®±æˆæƒç 
MAIL_FROM=future_234@qq.com
MAIL_SERVER=smtp.qq.com
DEVELOPMENT_MODE=false
```

## API ä½¿ç”¨æ–¹æ³•

### 1. å‘é€å¿˜è®°å¯†ç è¯·æ±‚

**ç«¯ç‚¹**: `POST /api/v1/auth/forgot-password`

**è¯·æ±‚ä½“**:
```json
{
  "email": "future_234@qq.com"
}
```

**curl ç¤ºä¾‹**:
```bash
curl -X POST http://localhost:8000/api/v1/auth/forgot-password \
     -H 'Content-Type: application/json' \
     -d '{"email": "future_234@qq.com"}'
```

**å“åº”**:
```json
{
  "success": true,
  "message": "éªŒè¯ç å·²å‘é€åˆ°æ‚¨çš„é‚®ç®±"
}
```

### 2. é‡ç½®å¯†ç 

**ç«¯ç‚¹**: `POST /api/v1/auth/reset-password`

**è¯·æ±‚ä½“**:
```json
{
  "email": "future_234@qq.com",
  "verification_code": "123456",
  "new_password": "newpassword123"
}
```

**curl ç¤ºä¾‹**:
```bash
curl -X POST http://localhost:8000/api/v1/auth/reset-password \
     -H 'Content-Type: application/json' \
     -d '{
       "email": "future_234@qq.com",
       "verification_code": "123456",
       "new_password": "newpassword123"
     }'
```

## å‰ç«¯é›†æˆç¤ºä¾‹

### JavaScript ä»£ç 

```javascript
// å‘é€å¿˜è®°å¯†ç è¯·æ±‚
async function sendForgotPasswordRequest(email) {
  try {
    const response = await fetch('/api/v1/auth/forgot-password', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({ email })
    });
    
    if (response.ok) {
      const data = await response.json();
      alert('éªŒè¯ç å·²å‘é€åˆ°æ‚¨çš„é‚®ç®±');
      return true;
    } else {
      const error = await response.json();
      alert('å‘é€å¤±è´¥: ' + error.message);
      return false;
    }
  } catch (error) {
    alert('ç½‘ç»œé”™è¯¯: ' + error.message);
    return false;
  }
}

// é‡ç½®å¯†ç 
async function resetPassword(email, verificationCode, newPassword) {
  try {
    const response = await fetch('/api/v1/auth/reset-password', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify({
        email,
        verification_code: verificationCode,
        new_password: newPassword
      })
    });
    
    if (response.ok) {
      const data = await response.json();
      alert('å¯†ç é‡ç½®æˆåŠŸ');
      return true;
    } else {
      const error = await response.json();
      alert('é‡ç½®å¤±è´¥: ' + error.message);
      return false;
    }
  } catch (error) {
    alert('ç½‘ç»œé”™è¯¯: ' + error.message);
    return false;
  }
}
```

## æµ‹è¯•è„šæœ¬

é¡¹ç›®æä¾›äº†å¤šä¸ªæµ‹è¯•è„šæœ¬ï¼š

1. **`test_real_email.py`**: æµ‹è¯•çœŸå®é‚®ä»¶å‘é€é…ç½®
2. **`test_forgot_password_api.py`**: æµ‹è¯•å®Œæ•´çš„å¿˜è®°å¯†ç APIæµç¨‹
3. **`email_demo.py`**: é‚®ä»¶åŠŸèƒ½æ¼”ç¤ºå’Œé…ç½®æŒ‡å—

### è¿è¡Œæµ‹è¯•

```bash
# è¿›å…¥åç«¯ç›®å½•
cd backend

# æµ‹è¯•é‚®ä»¶é…ç½®
python3 test_real_email.py

# æµ‹è¯•APIæµç¨‹
python3 test_forgot_password_api.py

# æŸ¥çœ‹æ¼”ç¤ºå’Œé…ç½®æŒ‡å—
python3 email_demo.py
```

## é‚®ä»¶æ¨¡æ¿

ç³»ç»Ÿå‘é€çš„éªŒè¯ç é‚®ä»¶åŒ…å«ï¼š

- ç¾è§‚çš„HTMLæ ¼å¼
- ç”¨æˆ·åä¸ªæ€§åŒ–
- çªå‡ºæ˜¾ç¤ºçš„éªŒè¯ç 
- è¿‡æœŸæ—¶é—´æé†’ï¼ˆ10åˆ†é’Ÿï¼‰
- å®‰å…¨æç¤º

## å®‰å…¨ç‰¹æ€§

1. **éªŒè¯ç è¿‡æœŸ**: éªŒè¯ç 10åˆ†é’Ÿåè‡ªåŠ¨è¿‡æœŸ
2. **å°è¯•æ¬¡æ•°é™åˆ¶**: é˜²æ­¢æš´åŠ›ç ´è§£
3. **é‚®ç®±éªŒè¯**: ç¡®ä¿é‚®ç®±åœ°å€æœ‰æ•ˆ
4. **ç¯å¢ƒå˜é‡ä¿æŠ¤**: æ•æ„Ÿä¿¡æ¯é€šè¿‡ç¯å¢ƒå˜é‡ç®¡ç†

## éƒ¨ç½²æ³¨æ„äº‹é¡¹

1. **ç”Ÿäº§ç¯å¢ƒ**: ç¡®ä¿è®¾ç½® `DEVELOPMENT_MODE=false`
2. **é‚®ç®±æˆæƒç **: å¦¥å–„ä¿ç®¡QQé‚®ç®±æˆæƒç 
3. **ç½‘ç»œé…ç½®**: ç¡®ä¿æœåŠ¡å™¨å¯ä»¥è®¿é—®QQé‚®ç®±SMTPæœåŠ¡
4. **æ—¥å¿—ç›‘æ§**: ç›‘æ§é‚®ä»¶å‘é€çŠ¶æ€å’Œé”™è¯¯æ—¥å¿—

## æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **è¿æ¥å¤±è´¥**: æ£€æŸ¥ç½‘ç»œè¿æ¥å’ŒSMTPæœåŠ¡å™¨é…ç½®
2. **è®¤è¯å¤±è´¥**: éªŒè¯QQé‚®ç®±æˆæƒç æ˜¯å¦æ­£ç¡®
3. **å‘é€å¤±è´¥**: æ£€æŸ¥é‚®ç®±æœåŠ¡æ˜¯å¦å¼€å¯SMTP
4. **éªŒè¯ç æ— æ•ˆ**: ç¡®è®¤éªŒè¯ç æœªè¿‡æœŸä¸”è¾“å…¥æ­£ç¡®

### è°ƒè¯•æ–¹æ³•

1. å¯ç”¨å¼€å‘æ¨¡å¼æŸ¥çœ‹è¯¦ç»†æ—¥å¿—
2. æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
3. ä½¿ç”¨æµ‹è¯•è„šæœ¬éªŒè¯åŠŸèƒ½
4. æŸ¥çœ‹åç«¯æœåŠ¡æ—¥å¿—

## æ€»ç»“

âœ… **å·²å®Œæˆçš„åŠŸèƒ½**:
- çœŸå®é‚®ä»¶å‘é€é…ç½®
- QQé‚®ç®±SMTPé›†æˆ
- éªŒè¯ç ç”Ÿæˆå’ŒéªŒè¯
- å¿˜è®°å¯†ç API
- å¯†ç é‡ç½®åŠŸèƒ½
- å¼€å‘/ç”Ÿäº§æ¨¡å¼åˆ‡æ¢
- å®Œæ•´çš„æµ‹è¯•è„šæœ¬
- å‰ç«¯é›†æˆç¤ºä¾‹

ğŸ‰ **çœŸå®é‚®ä»¶å‘é€åŠŸèƒ½å·²å®Œå…¨å®ç°å¹¶å¯æŠ•å…¥ä½¿ç”¨ï¼**

è¦å¯ç”¨çœŸå®é‚®ä»¶å‘é€ï¼Œåªéœ€ï¼š
1. è·å–QQé‚®ç®±æˆæƒç 
2. é…ç½® `.env` æ–‡ä»¶
3. è®¾ç½® `DEVELOPMENT_MODE=false`
4. é‡å¯åç«¯æœåŠ¡

ç³»ç»Ÿå°†è‡ªåŠ¨å‘ `future_234@qq.com` ç­‰çœŸå®é‚®ç®±å‘é€éªŒè¯ç é‚®ä»¶ã€‚